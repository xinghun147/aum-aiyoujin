<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
	<meta charset="utf-8"/>
	<title>提现付款列表--layui后台管理模板</title>
	<link rel="stylesheet" type="text/css" th:href="@{/layui/css/layui.css}" media="all" />
	<link rel="stylesheet" type="text/css" th:href="@{/css/news.css}" media="all" />
	<style>
		.news_search .layui-input-block{margin-left:auto;}
		.news_search .layui-form-label{padding:9px 10px;}
	</style>
</head>
<body class="childrenBody" style="width:1500px;">
	<blockquote class="layui-elem-quote news_search">
	<form id="searchForm" name="searchForm" class="layui-form" action="/order/withdraw/order3rdList.html">
		<input type="hidden" id="pageNum" name="pageNum" th:value="${page.pageNum}"/>
		<div class="layui-form-item">
			<label class="layui-form-label">用户编号:</label>
			<div class="layui-input-inline">
				<input type="text" value="" name="userName" class="layui-input search_input"/>
			</div>
			<label class="layui-form-label">订单编号:</label>
			<div class="layui-input-inline">
				<input type="text" value="" name="code" class="layui-input search_input"/>
			</div>
			<label class="layui-form-label">状态:</label>
			<div class="layui-input-inline">
				<select name="checkStatus" id="checkStatus" lay-filter="statusFilter" th:value="${checkStatus}">
					<option value="">请选择查询订单状态</option>
					<option value="0">处理中</option>
					<option value="1">付款成功</option>
					<option value="2">付款失败</option>
					<option value="3">已发货</option>
					<option value="4">已签收</option>
				</select>
			</div>
		</div>
		<div class="layui-form-item">
			<label class="layui-form-label">创建时间:</label>
			<div class="layui-input-inline">
				<input  type="text" class="layui-input" name="setUpTime" id="startTime"/>
			</div>
			<div class="layui-form-mid">-</div>
			<div class="layui-input-inline">
				<input  type="text" class="layui-input" name="setUpTimeEnd" id="endTime"/>
			</div>
			<button class="layui-btn search_btn"><i class="layui-icon">&#xe615;</i>查询</button>
		</div>
	</form>
	</blockquote>
	<div class="layui-form news_list">
	  	<table class="layui-table">
		    <colgroup>
				<col/>
				<col/>
				<col/>
				<col/>
		    </colgroup>
		    <thead>
				<tr>
					<th>
						<a class="layui-btn layui-btn-normal layui-btn-mini withdrawOrder3_selectAll">全选</a>
						<a class="layui-btn layui-btn-warm layui-btn-mini withdrawOrder3_allVerify">全部审核</a>
						</th>
					<th>用户编号</th>
					<th>订单编号</th>
					<th>提现金额</th>
					<th>手续费</th>
					<th>绑定银行卡</th>
					<th>状态</th>
					<th>审核人</th>
					<th>审核时间</th>
					<th>创建时间</th>
					<th>失败原因</th>
					<th>操作</th>
				</tr> 
		    </thead>
		    <tbody class="news_content">
		  	  <th:block th:if="${not #lists.isEmpty(page.list)}">
			    	<tr th:each="item:${page.list}">
			    		<td><input type="checkbox" name="" lay-skin="primary"></td>
				    	<td  th:text="${item.userName}"></td>
						<td  th:text="${item.code}"></td>
						<td  th:text="提现金额"></td>
						<td  th:text="手续费"></td>
						<td  th:text="绑定银行卡"></td>
						<th:block th:switch="${item.status}">
							<td  th:case="0">处理中</td>
							<td  th:case="1">付款成功</td>
							<td  th:case="2">付款失败</td>
							<td  th:case="3">已发货</td>
							<td  th:case="4">已签收</td>
						</th:block>
						<td  th:text="审核人"></td>
						<td  th:text="审核时间"></td>
						<td  th:text="创建时间"></td>
						<td  th:text="失败原因"></td>
				    	<td>
					    	<a th:data="${item.id}"  class="layui-btn layui-btn-mini withdrawOrder3_check">查看</a>
							<a th:data="${item.id}" class="layui-btn layui-btn-warm layui-btn-mini withdrawOrder3_verify">审核</a>
						</td>
					</tr>
				</th:block>
		    </tbody>
		</table>
	</div>
	<div id="paged" align="right"></div>
	<!--审核订单时的弹出层-->
	<div id="orderVerify" style="display: none;">
		<form class="layui-form">
			<div class="layui-form-item">
				<div class="layui-inline">
				</div>
			</div>
			<div class="layui-form-item">
				<label class="layui-form-label">记得审核呦</label>
				<input type="checkbox" lay-filter="auditResultFilter" id="auditResult" name="auditResult"
                       th:checked="${data}?${data.auditResult == 0}:false" th:value="${data}?${data.auditResult}:'1'"
                       lay-skin="switch" lay-text="通过|拒绝"/>
			</div>
			<div class="layui-form-item">
				<label class="layui-form-label">审核说明:</label>
				<div class="layui-input-inline">
					<textarea value="" name="" class="layui-input" required="required" style="min-height:80px;min-width:500px;"></textarea>
				</div>
			</div>
			<div class="layui-form-item" style="margin-top:80px;">
				<div class="layui-input-block">
					<button class="layui-btn submitDesc" lay-submit="" lay-filter="instantSubmit">立即提交</button>
					<button type="reset" class="layui-btn layui-btn-primary">重置</button>
				</div>
			</div>
		</form>
	</div>
	<script type="text/javascript" th:src="@{/layui/layui.js}"></script>
	<script type="text/javascript" th:src="@{/jquery/jquery-3.2.1.min.js}"></script>
	</body>
	<script th:inline="javascript">
         layui.use('laypage', function(){
        	  var laypage = layui.laypage;
        	  //执行一个laypage实例
        	  laypage.render({
        	    elem: 'paged', //注意，这里的 test1 是 ID，不用加 # 号
        	    curr: [[${page.pageNum}]],
        	    count: [[${page.total}]], //数据总数，从服务端得到
        	    layout: ['count', 'prev', 'page', 'next'],
                jump: function(obj, first){
                    //得到了当前页，用于向服务端请求对应数据
                    var curr = obj.curr;
                    $("#pageNum").val(curr);
                    if(!first) {
                        $("#searchForm").submit();
					}
                }
        	  });
        	});
        
        layui.use('layer',function(){
            var layer = layui.layer,$=layui.jquery;
            
            //全选
            $(".withdrawOrder3_selectAll").bind("click",function(){
            	var ipts=[];
            	Array.from($('input')).forEach(function(v,i){
            		if(v.type=="checkbox"){
            			ipts.push(v)
            		}
            	})
            	if(ipts.length!=0){
            		ipts.forEach(function(v,i){
            			v['checked']=true;
            			v.nextElementSibling.classList.add("layui-form-checked");
            		})
            	}
            })

			//查看
			$(".withdrawOrder3_check").bind("click",function() {
				var id = $(this).attr("data");
				form_html(id,'查看提现付款订单');
			});

			//审核
			$(".withdrawOrder3_verify").bind("click",function() {
				var id = $(this).attr("data");
				layer.open({
                    type: 1,
                    title:"订单审核",
                    content: $('#orderVerify'), //这里content是一个DOM，注意：最好该元素要存放在body最外层，否则可能被其它的相对元素所影响
                    area: ['700px', '400px']
                });
				
			});

             function form_html(id,title){
              	$.post('order3rdDetail.html', {id:id}, function(data){
            	  	layer.open({
            	  	  type: 1,
              		  title: title
              		  ,area: ['900px', '460px']
              		  ,shade: 0
              		  ,content: data
           			  ,yes: function(index, layero){
           				  layer.close(index);
           				}
              		}); 
            	}); 
            };
        });
        layui.use('laydate', function(){
        	  var laydate = layui.laydate;
        	  //执行一个laydate实例
        	  laydate.render({
        	    elem: '#startTime' //指定元素
        	  });
        	  //执行一个laydate实例
        	  laydate.render({
        	    elem: '#endTime' //指定元素
        	  });
        	});
        layui.use('form', function(){
             var form = layui.form;
             var option = [[${checkStatus}]];
             console.log(option);
             $('select').val(option);
             form.render();
         });
	</script>
</html>