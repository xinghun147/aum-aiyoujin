<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8"/>
    <title>充值订单列表</title>
    <link rel="stylesheet" type="text/css" th:href="@{/layui/css/layui.css}" media="all"/>
    <link rel="stylesheet" type="text/css" th:href="@{/css/news.css}" media="all"/>
</head>
<style>
    .layui-form-label {
        width: 60px;
    }

    .layui-form-item .layui-input-inline {
        float: left;
        width: 190px;
        margin-right: 5px;
    }

    .layui-select-title {
        width: 190px;
    }
</style>
<body class="childrenBody">
<blockquote class="layui-elem-quote news_search">
    <form id="searchForm" name="searchForm" class="layui-form" action="orderList.html">
        <input type="hidden" id="pageNum" name="pageNum" th:value="${page.pageNum}"/>
        <div class="layui-form-item">
            <label class="layui-form-label">订单编号:</label>
            <div class="layui-input-inline">
                <input type="text" class="layui-input" name="code" id="code" th:value="${vo.code}"/>
            </div>

            <label class="layui-form-label">用户名:</label>
            <div class="layui-input-inline">
                <input type="text" class="layui-input" name="userName" id="userId" th:value="${vo.userName}"/>
            </div>
            <!-- <label class="layui-form-label">支付渠道:</label>
            <div class="layui-input-inline">
                <input  type="text" class="layui-input" name="rechargeType" id="rechargeType"/>
            </div> -->
            <label class="layui-form-label">支付状态:</label>
            <div class="layui-input-inline">
                <select name="status" lay-verify="required" lay-search="">
                    <option value="">全部</option>
                    <option value="0" th:selected="${vo.status == 0}">处理中</option>
                    <option value="1" th:selected="${vo.status == 1}">充值成功</option>
                    <option value="2" th:selected="${vo.status == 2}">充值失败</option>
                </select>
            </div>
             <label class="layui-form-label">创建时间:</label>
			<div class="layui-input-inline">
				<input  type="text" class="layui-input" name="createTime" id="startTime" th:value="${vo.createTime}?${#dates.format(vo.createTime, 'yyyy-MM-dd HH:mm:ss')}"/>
			</div>
			<div class="layui-form-mid">-</div>
			<div class="layui-input-inline">
				<input  type="text" class="layui-input" name="updateTime" id="endTime" th:value="${vo.updateTime}?${#dates.format(vo.updateTime, 'yyyy-MM-dd HH:mm:ss')}"/>
			</div>
            <button class="layui-btn search_btn"><i class="layui-icon">&#xe615;</i>查询</button>
            <a class="layui-btn excel_btn"><i class="layui-icon">&#xe615;</i>导出</a>
        </div>
        <div class="layui-form-item">
            <!-- <div class="layui-inline" style="margin-right:-4px;">
                <label class="layui-form-label">支付方式</label>
                <div class="layui-input-inline">
                       <select name="modules" lay-verify="required" lay-search="">
                         <option value="">请选择支付方式</option>
                         <option value="1">京东快捷</option>
                       </select>
                </div>
               </div>
               <div class="layui-inline">
                <label class="layui-form-label">支付状态</label>
                <div class="layui-input-inline">
                       <select name="status" lay-verify="required" lay-search="">
                         <option value="">请选择支付状态</option>
                         <option value="0">处理中</option>
                         <option value="1">充值成功</option>
                         <option value="2">充值失败</option>
                       </select>
                </div>
            </div>
            <a class="layui-btn search_btn" style="vertical-align: initial;"><i class="layui-icon">&#xe615;</i>查询</a>-->
        </div>
    </form>
</blockquote>
<div class="layui-form news_list">
    <table class="layui-table">
        <thead>
        <tr>
            <th>订单编号</th>
            <th>用户名</th>
            <th>充值金额</th>
            <th>手续费</th>
            <th>支付方式</th>
            <th>支付渠道</th>
            <th>支付状态</th>
            <th>创建时间</th>
            <th>失败原因</th>
            <th>操作</th>
        </tr>
        </thead>
        <tbody class="news_content">
        <th:block th:if="${not #lists.isEmpty(page.list)}">
            <tr th:each="item:${page.list}">
                <td th:text="${item.code}"></td>
                <td th:text="${item.userName}"></td>
                <td th:text="${item.amount}"></td>
                <td th:text="${item.fee}"></td>
                <td th:text="${item.payProductName}"></td>
                <td th:text="${item.payChannelName}"></td>
                <th:block th:switch="${item.status}">
                    <td th:case="0">处理中</td>
                    <td th:case="1">充值成功</td>
                    <td th:case="2">充值失败</td>
                    <td th:case="*">未知状态</td>
                </th:block>
                <td th:text="${#dates.format(item.createTime,'yyyy-MM-dd HH:mm:ss')}"></td>
                <td th:text="${item.remark}"></td>
                <td>
                    <a th:data="${item.id}" class="layui-btn layui-btn-mini recharge_view">查看</a>
                    <th:block th:if="${item.status eq 0}">
                        <a th:data="${item.id}" class="layui-btn layui-btn-danger layui-btn-mini order_recheck">人工确认</a>
                    </th:block>
                </td>
            </tr>
        </th:block>
        </tbody>
    </table>
</div>
<div id="paged" align="right"></div>
<script type="text/javascript" th:src="@{/layui/layui.js}"></script>
<script type="text/javascript" th:src="@{/jquery/jquery-3.2.1.min.js}"></script>
</body>
<script th:inline="javascript">
    layui.use('form', function () {
        var form = layui.form;
        form.render();
        //导出excel
        $(".excel_btn").bind("click", function () {
            location.href = '/report/rechargeOrderExcel?' + $("#searchForm").serialize();
        });
    });
    layui.use('laypage', function () {
        var laypage = layui.laypage;
        //执行一个laypage实例
        laypage.render({
            elem: 'paged', //注意，这里的 test1 是 ID，不用加 # 号
            curr: [[${page.pageNum}]],
            count: [[${page.total}]], //数据总数，从服务端得到
            layout: ['count', 'prev', 'page', 'next'],
            jump: function (obj, first) {
                //得到了当前页，用于向服务端请求对应数据
                var curr = obj.curr;
                $("#pageNum").val(curr);
                if (!first) {
                    $("#searchForm").submit();
                }
            }
        });
    });

    layui.use('layer', function () {
        var layer = layui.layer, $ = layui.jquery;
        /* 查看  */
        $(".recharge_view").bind("click", function () {
            var id = $(this).attr("data");
            form_html(id, "查看")
        });
        $(".order_recheck").bind("click", function () {
            var id = $(this).attr("data");
            //toHandleOrders
            $.get("toHandleOrders?rechargeId=" + id, function (datas) {
                console.log(datas);
                var result = JSON.parse(datas);
                if (result.code > 0) {
                    layer.msg(result.msg, {
                        time: 2000, //3s后自动关闭
                    });
                    setTimeout(function () {
                        location.reload(true);
                    }, 500);
                } else {
                    layer.msg(result.msg, {
                        time: 1000, //1s后自动关闭
                    });
                    setTimeout(function () {
                        location.reload(true);
                    }, 500)
                }
            })
            console.log("点击了人工对账")
        })

        function form_html(id, title) {
            $.post('orderDetail.html', {id: id}, function (data) {
                layer.open({
                    type: 1,
                    title: title
                    , area: ['430px', '520px']
                    , shade: 0
                    , content: data
                    , yes: function (index, layero) {
                        layer.close(index);
                    }
                });
            });
        };
    });
    layui.use('laydate', function () {
        var laydate = layui.laydate;
        //执行一个laydate实例
        laydate.render({
            elem: '#startTime' //指定元素
            , type: 'datetime'
            , max: 1
            , format: 'yyyy-MM-dd HH:mm:ss' //可任意组合
        });
        //执行一个laydate实例
        laydate.render({
            elem: '#endTime' //指定元素
            , type: 'datetime'
            , max: 1    
            , format: 'yyyy-MM-dd HH:mm:ss' //可任意组合
        });
    });

</script>
</html>