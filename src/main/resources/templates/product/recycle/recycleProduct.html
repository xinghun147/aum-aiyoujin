<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
	<meta charset="utf-8"/>
	<title>存金产品列表</title>
	<link rel="stylesheet" type="text/css" th:href="@{/layui/css/layui.css}" media="all" />
	<link rel="stylesheet" type="text/css" th:href="@{/css/news.css}" media="all" />
</head>
<body class="childrenBody" style="width:1400px;">
	<blockquote class="layui-elem-quote news_search">
	<form id="searchForm" name="searchForm" class="layui-form" action="/product/recycle/recycleProduct.html">
		<input type="hidden" id="pageNum" name="pageNum" th:value="${page.pageNum}"/>
		  <div class="layui-form-item">
            <label class="layui-form-label">产品编号:</label>
            <div class="layui-input-inline">
                <input  type="text" class="layui-input" name="code"  th:value="${code}"/>
            </div>
            <label class="layui-form-label">产品名称:</label>
            <div class="layui-input-inline">
                 <input  type="text" class="layui-input" name="name"  th:value="${name}"/>
            </div>
			<label class="layui-form-label">产品状态</label>
			<div class="layui-input-inline">
				<select name="checkStatus" id="checkStatus" lay-filter="statusFilter" th:value="${checkStatus}">
					<option value="">请选择查询产品状态</option>
					<option value="0">草稿未上架</option>
					<option value="1">上架未开售</option>
					<option value="2">正在销售中</option>
					<option value="3">售磬未下架</option>
					<option value="4">下架</option>
				</select>
			</div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">创建时间:</label>
            <div class="layui-input-inline">
                <input  type="text" class="layui-input" name="startTime" th:value="${startTime}" id="startTime"/>
            </div>
            <div class="layui-form-mid">-</div>
            <div class="layui-input-inline">
                <input  type="text" class="layui-input" name="endTime" th:value="${endTime}" id="endTime"/>
            </div>
		    <button class="layui-btn search_btn"><i class="layui-icon">&#xe615;</i>查询</button>
            <a class="layui-btn layui-btn-normal newsAdd_btn" id="add"><i class="layui-icon">&#xe608;</i>添加</a>
         </div>
	</form>
	</blockquote>
	<div class="layui-form news_list">
	  	<table class="layui-table">
		    <colgroup>
				<col width="10%"/>
				<col width="5%"/>
				<col width="10%"/>
				<col width="10%"/>
				<col width="10%"/>
				<col width="15%"/>
				<col width="10%"/>
				<col width="10%"/>
				<col width="30%"/>
		    </colgroup>
		    <thead>
				<tr>
					<th>产品编号</th>
					<th>产品名称</th>
					<th>起存克重（克）</th>
					<th>标准损耗克重（克）</th>
					<th>标准金价折扣（元）</th>
					<th>产品状态</th>
					<th>创建人</th>
					<th>创建时间</th>
					<th>操作</th>
				</tr> 
		    </thead>
		    <tbody class="news_content">
		  	  <th:block th:if="${not #lists.isEmpty(page.list)}">
			    	<tr th:each="item:${page.list}">
				    	<td  th:text="${item.code}"></td>
						<td  th:text="${item.name}"></td>
						<td  th:text="${item.minWeight}"></td>
						<td  th:text="${item.lossWeight}"></td>
						<td  th:text="${item.discountPrice}"></td>
						<th:block th:switch="${item.status}">
						    <td  th:case="0">草稿未上架</td>
							<td  th:case="1">上架未开售</td>
							<td  th:case="2">正在销售中</td>
							<td  th:case="3">售磬未下架</td>
							<td  th:case="4">下架</td>
						</th:block>
						<td  th:text="${item.createBy}"></td>
						<td  th:text="${#dates.format(item.createTime,'yyyy-MM-dd HH:mm:ss')}"></td>
				    	<td>
							<a th:data="${item.id}" th:remove="${item.status == 0 or item.status == 4}?none:all" class="layui-btn layui-btn-mini shelves">上架</a>
							<a th:data="${item.id}" th:remove="${item.status == 1}?none:all" class="layui-btn layui-btn-mini sale">开售</a>
							<a th:data="${item.id}" th:remove="${item.status == 2 or item.status == 3}?none:all" class="layui-btn layui-btn-mini offShelf">下架</a>
                            <a th:data="${item.id}" th:value="${item.version}"  class="layui-btn layui-btn-mini recycle_product_view">查看</a>
					    	<a th:data="${item.id}" th:remove="${item.status == 0 or item.status == 4}?none:all" th:value="${item.version}"  class="layui-btn layui-btn-mini recycle_product_edit">编辑</a>
							<a th:data="${item.id}" th:value="${item.version}" class="layui-btn layui-btn-danger layui-btn-mini recycle_product_del">删除</a>
						</td>
					</tr>
				</th:block>
		    </tbody>
		</table>
	</div>
	<div id="paged" align="right"></div>
	<script type="text/javascript" th:src="@{/layui/layui.js}"></script>
    <script type="text/javascript" th:src="@{/jquery/jquery-3.2.1.min.js}"></script>
	</body>
	<script th:inline="javascript">
         layui.use('laypage', function(){
        	  var laypage = layui.laypage;
        	  //执行一个laypage实例
        	  laypage.render({
        	    elem: 'paged', //注意，这里的 test1 是 ID，不用加 # 号
        	    curr: [[${page.pageNum}]],
        	    count: [[${page.total}]], //数据总数，从服务端得到
        	    layout: ['count', 'prev', 'page', 'next'],
                jump: function(obj, first){
                    //得到了当前页，用于向服务端请求对应数据
                    var curr = obj.curr;
                    $("#pageNum").val(curr);
                    if(!first) {
                        $("#searchForm").submit();
					}
                }
        	  });
        	});
        
        layui.use('layer', function(){
            var layer = layui.layer,$=layui.jquery;

            $(".shelves").bind("click",function () {
                var id = $(this).attr('data');
                layer.confirm('确定要上架吗?', {icon: 3, title:'提示'}, function(index){
                    $.post('updateProductStatus.html', {id:id,status:1}, function(data){
                        location.reload();
                    });
                });
            });

            $(".offShelf").bind("click",function () {
                var id = $(this).attr('data');
                layer.confirm('确定要下架该产品吗?', {icon: 3, title:'提示'}, function(index){
                    $.post('updateProductStatus.html', {id:id,status:4}, function(data){
                        location.reload();
                    });
                });
            });
            
            $(".sale").bind("click",function () {
                var id = $(this).attr('data');
                layer.confirm('确定要销售该产品吗?', {icon: 3, title:'提示'}, function(index){
                    $.post('updateProductStatus.html', {id:id,status:2}, function(data){
                        location.reload();
                    });
                });
            });
            
            //删除
            $(".recycle_product_del").bind("click",function() {
                var id = $(this).attr("data");
                layer.confirm('确定要删除吗?', {icon: 3, title:'提示'}, function(index){
                	  location.href="recycleProductDel.html?id="+id;
                });
            });
            
            //查看
            $(".recycle_product_view").bind("click",function() {
                var id = $(this).attr("data");
                var version = $(this).attr("value");
                //Ajax获取
                $.post('recycleProductInfo.html', {id:id,version:version}, function(data){
                    layer.open({
                      type: 1,
                      title: "查看存金产品"
                      ,area: ['1000px', '520px']
                      ,shade: 0
                      ,content: data
                      ,yes: function(index, layero){
                          layer.close(index);
                        }
                    }); 
                }); 
            });

            //编辑
            $(".recycle_product_edit").bind("click",function() {
                var id = $(this).attr("data");
                var version = $(this).attr("value");
                //Ajax获取
            	form_html(id,version,'编辑存金产品');
            });

            /**
			 * 添加
             */
            $("#add").bind("click",function() {
            	//Ajax获取
            	form_html("","",'添加存金产品');
            });
            
             function form_html(id,version,title){
              	$.post('recycleProductAdd.html', {id:id,version:version}, function(data){
            	  	layer.open({
            	  	  type: 1,
              		  title: title
              		  ,area: ['1000px', '520px']
              		  ,shade: 0
              		  ,content: data
           			  ,yes: function(index, layero){
           				  layer.close(index);
           				}
              		}); 
            	}); 
            };
        });



        
        layui.use('laydate', function(){
        	  var laydate = layui.laydate;
        	  //执行一个laydate实例
        	  laydate.render({
        	    elem: '#startTime', //指定元素
                type: 'datetime',
                format: 'yyyy-MM-dd HH:mm:ss'
        	  });
        	  //执行一个laydate实例
        	  laydate.render({
        	    elem: '#endTime', //指定元素
				      type: 'datetime',
              format: 'yyyy-MM-dd HH:mm:ss'
        	  });
        	});

         layui.use('form', function(){
             var form = layui.form;
             var option = [[${checkStatus}]];
             console.log(option);
             $('select').val(option);
             form.render();
         });
	</script>
</html>